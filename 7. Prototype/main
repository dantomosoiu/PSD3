#!/bin/bash
#PSD3 Prototype for Internship Management System
#Version 1.0

function login() {

exit=0
quit=0

while [[ ! $exit -eq 1 ]];
do 

	#get username
	echo -n "Enter username: "
	read username
	if [ ! -z $username ]
		then username=$(cat .users.csv | grep --no-messages $username)
		fi

	while [ -z "$username" ];
	do
		echo "Incorrect username entered. Please try again"
		echo -n "Enter username: "
		read username
		
		if [ ! -z $username ]
			then username=$(cat .users.csv | grep --no-messages $username)
			fi
		
	done


	#get password
	echo -n "Enter password: "
	read -s password
	if [ ! -z $password ]
		then password=$(echo $username | grep -c $password)
		fi
	
	while [ -z "$password" ];
	do
		echo "No password entered. Please try again"
		echo -n "Enter password: "
		read -s password
		if [ ! -z $password ]
			then password=$(echo $username | grep -c $password)
			fi
	done
	
	

	#process username and password
	if [[  $password = 1 ]]; then
		userType=$(echo $username | grep -o " student" | grep -o "student")
		userType=$(echo $userType$(echo $username | grep -o "coordinator"))
		userType=$(echo $userType$(echo $username | grep -o "academic"))
		userType=$(echo $userType$(echo $username | grep -o "organisation"))
		exit=1;
	else
		echo "Wrong Password. Please try again."
		echo
	fi
	

done

}


function menu() {
	echo
	echo "Please choose an option from the menu below by entering the appropriate number and pressing enter. q to exit:"

	if [[ "$userType" = "student" ]]; then
		echo "1. Review advertisements"
		echo "2. Notify course coordinator of placement success"
		echo
		processMenuChoice
	elif [[ "$userType" = "coordinator" ]]; then
		echo "1. Review advertisements"
		echo "2. View current status of studentsâ€™ internship applications"
		echo "3. Approve student internship placements"
		echo "4. Approve User"
		echo
		processMenuChoice
	elif [[ "$userType" = "academic" ]]; then
		echo "1. Submit advertisement"
		echo "2. View submitted advertisements"
		echo
		processMenuChoice
	elif [[ "$userType" = "organisation" ]]; then
		echo "1. Submit advertisement"
		echo "2. View submitted advertisements"
		echo
		processMenuChoice
	else quit=1
	fi
}

function processMenuChoice() {
	read choice #get user choice

	while [ -z "$choice" ]; #keep asking for choice if empty string entered
	do
		echo "No choice entered"
		echo -n "Enter choice and press enter: "
		read choice
	done

	if [[ "$choice" = "q" ]]; then
		quit=1
	elif [[ "$userType" = "student" && "$choice" -eq 1 ]]; then
		echo "ID, Owner, Duration, Payment, SECompliant, Positions, Info, Visible, Expires"
		cat .placement.csv | grep "true.*true"
		cat .placement.csv | grep "false.*true"
	elif [[ "$userType" = "student" && "$choice" -eq 2 ]]; then
		echo "choice 2" 
		processPlacement
	elif [[ "$userType" = "coordinator" && "$choice" -eq 1 ]]; then
		cat .placement.csv
	elif [[ "$userType" = "coordinator" && "$choice" -eq 2 ]]; then
		cat .studentPlacement
	elif [[ "$userType" = "coordinator" && "$choice" -eq 3 ]]; then
		echo "choice 3"
	elif [[ "$userType" = "coordinator" && "$choice" -eq 4 ]]; then
		echo "choice 4"
	elif [[ "$userType" = "academic" && "$choice" -eq 1 ]]; then
		echo "choice 1"
	elif [[ "$userType" = "academic" && "$choice" -eq 2 ]]; then
		echo "choice 2"
	elif [[ "$userType" = "organisation" && "$choice" -eq 1 ]]; then
		echo "choice 1"
	elif [[ "$userType" = "organisation" && "$choice" -eq 2 ]]; then
		echo "choice 2"	
	fi
	echo "Enter to continue"
	read cont

}

function processPlacement() {
	echo
	echo "Please choose an option from the menu below by entering the appropriate number and pressing enter. q to exit:"

	echo "1. The placement was found using the University of Glasgow Internship Management System"
	echo "2. The placement was found externally"
	echo
	read choice #get user choice

	while [ -z "$choice" ]; #keep asking for choice if empty string entered
	do
		echo "No choice entered"
		echo -n "Enter choice and press enter: "
		read choice
	done

	if [[ "$choice" = "q" ]]; then
		cont=0
	elif [[ "$choice" -eq 1 ]]; then
	echo "Select the correct position by number"
		echo "ID, Owner, Duration, Payment, SECompliant, Positions, Info, Visible, Expires"
		cat .placement.csv | grep "true.*true"
		cat .placement.csv | grep "false.*true"
		read choice
		choice=$(cat .placement.csv | grep "$choice, ")
		echo $choice $username >> .studentPlacement
		echo "Thank you. Your response has been saved and is awaiting approval from the course coordinator. You will be contacted by email in due course."
		
		
	elif [[ "$choice" -eq 2 ]]; then
		echo "Enter Placement in form Owner, Duration, Payment, SECompliant, Positions, Info, Visible, Expires"
		read placement
		echo $placement $username >> .studentPlacement
		echo "Thank you. Your response has been saved and is awaiting approval from the course coordinator. You will be contacted by email in due course."
	fi
}



# START MAIN PROGRAM #
echo
echo "Welcome to the University of Glasgow Internship Management System"
echo
login
while [[ ! $quit -eq 1 ]];
do 
	menu
done

#result=$userType   # or result=`myfunc`
#echo $userType

